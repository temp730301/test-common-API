#!/bin/bash


if [ $# -ge 1 ]; then


#! /bin/bash
while getopts cf: OPT
do
  case $OPT in
     c) echo "[-c] が指定された";;
     f)
       echo "[-f] が指定された" $OPTARG
       patchFile=$OPTARG
       ;;
     *) echo "該当なし（OPT=$OPT）";;
  esac
done




echo -n> $patchFile.txt
while read line; do
    address=`echo -n ${line} | cut -d : -f 1 | sed "s/^ *\| *$//"`
    data=`echo -n ${line} | cut -d : -f 2 | sed -e 's/^ *\| *$//' | sed -e 's/[\r\n]\+//g' | sed -e 's/[\n]\+//g'`

    shortAddress=${address:4}

  if [ ${#data} -eq 12 ]; then
    dataHi=`echo -n ${data} | cut -c 1-4`
    dataMid=`echo -n ${data} | cut -c 5-8`
    dataLow=`echo -n ${data} | cut -c 9-12`
    echo -n "${shortAddress}${dataLow}${dataMid}${dataHi}" >> $patchFile.txt
  else
    echo "Error"
  fi


#    dataLow=`echo -n ${data} | rev | cut -c 1-4 | rev`
#    dataLow=${data:4}

#    dataMid=`echo -n ${data} | cut -c 1-4 | rev`
#    dataMidWk=${data::8}
#    dataMid=${dataMidWk:4}
#    dataHi=${data::4}

#    echo ${shortAddress}
#    echo ${dataLow}
#    echo ${dataMid}
#    echo ${dataHi}
  done < $patchFile

cat $patchFile.txt | xxd -r -p > $patchFile.bin

else
  echo mm.sh filename
fi